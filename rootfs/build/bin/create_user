#!/bin/bash

user=${1:-"tom"}
group=${2:-"tom"}
echo "Create user: $user Group $group"
egrep "^$group:" /etc/group > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "create group $group"
    groupadd $group
else
    echo "Group $group exist"
fi
egrep "^$user:" /etc/passwd > /dev/null 2>&1
if [ $? -ne 0 ]; then
    echo "create user $user"
    useradd -r -g $group -d /home/$user -s /bin/bash $user
    usermod -aG sudo $user
    echo "$user ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
else
    echo "User $user exist"
fi

mkdir -p /home/$user
chown -R $user:$group /home/$user

